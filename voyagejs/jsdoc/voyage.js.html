<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: voyage.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: voyage.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file
 * voyage framework
 *
 * some syntax sugars for preact (a lighter version of react)
 *
 * this version is developed during 20250814 ~ (utc+8)
 *
 * @description
 * 
 * features
 * 
 * @author firavoyage
 * @version 1.0
 * @since 0.1 initiated on 20240816, 1.0 initiated on 20250814
 * @see changelog.md
 */

const preact = {
  ...window.preact,
  ...window.preactHooks,
};

let voyage = {
  // preact methods with some sugar
  h(..._) {
    // html
    const { createElement, Fragment } = preact;

    // todo: support more patterns of _ (done)
    // todo: support Fragment (done)

    let tag = "",
      props = {},
      children = [];

    for (const [index, item] of _.entries()) {
      const type = typeof item;
      if ((type == "string" || type == "function") &amp;&amp; index == 0) {
        tag = item;
      } else if (type == "object") {
        if (item.constructor) {
          // props have a constructor like object
          props = item;
        } else {
          // for children created by preact.createElement(), constructor == undefined
          children.push(item);
        }
      } else if (type == "function") {
        // components should be wrapped in createElement
        children.push(createElement(item));
      } else {
        children.push(item);
      }
    }

    if (tag == "") {
      // "" and Fragment are considered the same
      tag = Fragment;
    }

    for (const key in props) {
      const value = props[key];

      if (key.startsWith("@")) {
        const newKey = `on${key.slice(1, 2).toUpperCase()}${key.slice(2)}`;
        props[newKey] = value;
        delete props[key];
      } else if (key == "bind") {
        props.value = value();
        props.onChange = (e) => value(e.target.value);
        delete props[key];
      }
    }

    return createElement(tag, props, ...children);
  },
  p(initial) {
    // prop
    const { useState } = preact;
    const [state, setState] = useState(initial);
    return (..._) => {
      if (_.length == 0) {
        return state;
      } else if (_.length == 1) {
        setState(_[0]);
      }
    };
  },
  e(e, deps = []) {
    // effect
    // for safety reason, deps should not be empty in any case

    // todo: for fn (prop) in deps, call it. (done)

    const { useEffect } = preact;

    deps.map((dep) => (typeof dep == "function" ? dep() : dep));
    useEffect(e, deps);
  },
  r(app, parent, replaceNode) {
    // render
    const { render, createElement } = preact;

    // todo: for fn apps, wrap it with h() (done)

    if (typeof app == "function") {
      app = createElement(app);
    }

    render(app, parent, replaceNode);
  },
};

const { h, p, e, r } = voyage;

let examples = {
  HelloWorld() {
    const name = p("world");

    return `hello ${name()}`;
  },
  Label() {
    const { name, src } = p();

    return ["img", { src, alt: t`${name} dancing` }];
  },
  Html() {
    const { content } = p({
      content: `here's some &lt;strong>HTML!!!&lt;/strong>`,
    });

    return html(content);
  },
  Ref() {
    const { content, parent } = p({
      content: `here's some &lt;strong>HTML!!!&lt;/strong>`,
    });

    e(() => {
      parent().innerHTML = content();
    });
    return ["p", { ref: parent }];
  },
  Counter() {
    const count = p(0);

    e(() => {
      console.log(count());
    }, [count]);

    return h(
      h("button", { "@click": () => count(+count() - 1) }, "-"),
      h("input", { type: "text", bind: count }),
      h("button", { "@click": () => count(+count() + 1) }, "+")
    );
  },
  SimpleCounter() {
    const { count } = p({ count: 0 });

    return [
      "button",
      { "@click": () => count((x) => x + 1) },
      t`clicked ${count} ${() => (count() > 1 ? "times" : "time")}`,
    ];
  },
  DerivedCounter() {
    const { count } = p({ count: 0 });

    const doubled = () => count() * 2;
    const quadrupled = () => doubled() * 2;

    return [
      [
        "button",
        {
          "@click": () => count(count() + 1),
        },
        t`Count: ${count}`,
      ],
      ["p", t`${count} * 2 = ${doubled}`],
      ["p", t`${doubled} * 2 = ${quadrupled}`],
    ];
  },
  Effect() {
    const { count } = p({ count: 0 });

    e(() => {
      if (count() >= 10) {
        // count is dangerously high!
        count(9);
      }
    });
    return [
      "button",
      {
        "@click": () => count(count() + 1),
      },
      t`clicked ${count} ${() => (count() > 1 ? "times" : "time")}`,
    ];
  },
  IntervalEffect() {
    const { count } = p({ count: 0 });

    e(() => {
      interval = setInterval(() => {
        count(count() + 1);
      }, 1000);
      return () => clearInterval(interval);
    });
    return ["p", count];
  },
  Condition() {
    const { x } = p({ x: 7 });

    return show(
      () => x() > 10,
      t`${x} is greater than 10`,
      () => x() &lt; 5,
      t`${x} is less than 5`,
      t`${x} is between 5 and 10`
    );
  },
  ChangeableCondition() {
    const { x } = p({ x: 3 });

    e(() => {
      interval = setInterval(() => {
        x(x() + 1);
      }, 1000);
      return () => clearInterval(interval);
    });
    return show(
      () => x() > 10,
      t`${x} is greater than 10`,
      () => x() &lt; 5,
      t`${x} is less than 5`,
      t`${x} is between 5 and 10`
    );
  },
  List() {
    const cats = [
      { id: "J---aiyznGQ", name: "Keyboard Cat" },
      { id: "z_AbfPXTKms", name: "Maru" },
      { id: "OUtn3pvWmpg", name: "Henri The Existential Cat" },
    ];

    return [
      ["h1", "The Famous Cats of YouTube"],
      [
        "ul",
        each(cats, ({ id, name }, i) => [
          "li",
          [
            "a",
            {
              target: "_blank",
              rel: "noreferrer",
              href: t`https://www.youtube.com/watch?v=${id}`,
            },
            t`${i + 1}: ${name}`,
          ],
        ]),
      ],
    ];
  },
  Thing() {
    // `color` is updated whenever the prop value changes...
    const { color } = p();

    // ...but `initial` is fixed upon initialisation
    const initial = color();

    return [
      "p",
      ["span", { style: { "background-color": initial } }, "initial"],
      ["span", { style: { "background-color": color } }, "current"],
    ];
  },
  Store() {
    const { p } = p();
    p({ abc: "def" });
    p("abc", "xyz");
    p("foo", "bar");

    return () => JSON.stringify(p());
  },
};

voyage.r(examples.Counter, document.body);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sat Aug 16 2025 04:12:34 GMT+0800 (Taipei Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
